<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" type="image/x-icon" href="/images/SiSt.ico">
<title>2026. 2. 9. 오후 12:26:13</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="/resources/cdn-main/example.css">
<script src="/resources/cdn-main/example.js"></script>
<style>
span.material-symbols-outlined {
	vertical-align: text-bottom;
}
</style>
</head>
<body>
	<header>
		<h1 class="main">
			<a href="#" style="position: absolute; top: 30px;">CHacHa's HOme</a>
		</h1>
		<ul>
			<li><a href="#">로그인</a></li>
			<li><a href="#">회원가입</a></li>
		</ul>
	</header>
	<div>
		<xmp class="code"> /board/read.html </xmp>

		<h1>Board Read Page</h1>

		<div>
			<label>Bno</label> <input type="text" name="bno" readonly
				th:value="${dto.bno}">
		</div>
		<div>
			<label>Title</label> <input type="text" name="title" readonly
				th:value="${dto.title}">
		</div>
		<div>
			<label>Content</label>
			<textarea rows="5" name="content" readonly>[[${dto.content}]]</textarea>
		</div>
		<div>
			<label>Writer</label> <input type="email" name="writer" readonly
				th:value="${dto.writerName}">
		</div>
		<div>
			<label>RegDate</label> <input type="text" name="regDate" readonly
				th:value="${#temporals.format(dto.regDate, 'yyyy/MM/dd HH:mm:ss')}">
		</div>
		<div>
			<label>ModDate</label> <input type="text" name="modDate" readonly
				th:value="${#temporals.format(dto.modDate, 'yyyy/MM/dd HH:mm:ss')}">
		</div>
		<br> <a
			th:href="@{/board/modify(bno=${dto.bno}, page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}">
			<button type="button">Modify</button>
		</a> <a
			th:href="@{/board/list(page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}">
			<button type="button">List</button>
		</a>
		<!-- 댓글 화면 처리 부분 -->
		<div>
			<div>
				<h5>
					<span class="addReply">Add Reply</span>
				</h5>
				<h5>
					<span class="replyCount">Reply Count : [[${dto.replyCount}]]</span>
				</h5>
			</div>
			<!-- 해당 게시글의 댓글 정보를  ajax 가져와서 출력 -->
			<div class="replyList" style="border: 1px solid blue; padding: 10px;">
			</div>
			<script th:inline="javascript">
   $( function(){
     var bno = [[${dto.bno}]];
     var listGroup = $(".replyList");
    // 날짜 처리 함수
     function formatTime(str){
        var date = new Date(str);
        return date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate()+" " + date.getHours()+":"+date.getMinutes();
     } // function formatTime
     
     // 특정 게시글 번호의 댓글을 조회하는 함수
     function loadJSONDate() {
       // $.ajax()  jquery 메서드만 사용. 
        $.getJSON('/replies/board/'+bno, function (arr){
          // console.log( arr );
          var str = "";
          $(".replyCount").html(" Reply Count : " + arr.length);
          $.each(arr, function (idx, reply){
            console.log(reply);
            str += '  <div class="card-body" data-rno="'+reply.rno+'"><b>'+reply.rno+'</b>';
            str += '    <h5 class="card-title">'+reply.text+'</h5>';
            str += '    <h6 class="card-subtitle">'+reply.replyer+'</h6>';
            str += '    <p>'+formatTime(reply.regDate)+'</p>';
            str += '  </div>';
          }); // $.each(
          
          listGroup.html(str);
           
        }); // $.getJSON('
     }
     
     $(".replyCount").on("click", function() {
       loadJSONDate(); 
     });

     // 댓글 추가버튼 클릭
     var modal=$(".modal");
     $(".addReply").on("click", function() {
       modal.show();
     });
     // 댓글 모달창 닫기
     $(".replyClose").on("click", function() {
       modal.hide();
     });
     // 댓글등록 시작///////////////////////////
     $(".replySave").on("click",function(){
    	 var reply = {
                 bno:bno,    
                 text: $('input[name="replyText"]').val(),
                 replyer: $('input[name="replyer"]').val(),
              };
    	 $.ajax({
             url:'/replies',
             method:'post', 
             data: JSON.stringify(reply),
             contentType: 'application/json; charset=utf-8',
             dataType: 'json',
             success: function(data){
               console.log(data);
               
               var newRno = parseInt(data);
               alert(newRno + "번 댓글이 등록되었습니다.");
               modal.hide();
               
               loadJSONData(); //다시 해당 게시글의 댓글 목록을 ajax처리
             }
           }); // $.ajax({
     })	
     
     // 댓글등록 끝///////////////////////////
     
   }); // $( function(){
   </script>
			<!--  댓글 추가 사용할 모달창 -->
			<div class="modal"
				style="border: solid 1px red; padding: 10px; display: none;">
				<h5>Reply Modal title(댓글 추가 모달창)</h5>
				<button type="button">
					<span>&times;</span>
				</button>
				<br> <input type="text" name="replyText"
					placeholder="Reply Text..."> <br> <input type="text"
					name="replyer" placeholder="Replyer..."> <br> <input
					type="hidden" name="rno"> <br>
				<button type="button" class="replyRemove">Remove</button>
				<button type="button" class="replyModify">Modify</button>
				<button type="button" class="replySave">Save</button>
				<button type="button" class="replyClose">Close</button>
			</div>
		</div>
	</div>
</body>
</html>